<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4" main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <Sequence>
      <!-- Config -->
      <Script name="Configure ROS2 Actions" code="arm_action:='panda_arm_controller/follow_joint_trajectory'; gripper_action:='panda_hand_controller/gripper_cmd'; planner_action:='compute_plan_to_pose'"/>

      <SaySomething name="Print message" message="Grabbing object initialized"/>
      <GetGrasp name="Get object grasp pose" object_pose="{object_pose}" pregrasp="{pregrasp_pose}" grasp="{grasp_pose}"/>

      <!-- Pick Object -->
      <Plan action_name="{planner_action}" name="Plan to pre-grasp pose" target_ik="{pregrasp_pose}" trajectory="{trajectory_msg}"/>
      <Move action_name="{arm_action}" name="Move to pre-grasp pose" trajectory="{trajectory_msg}"/>
      <Grip action_name="{gripper_action}" name="Open Gripper" pose="0.04"/>

      <Plan action_name="{planner_action}" name="Plan to grasp pose" target_ik="{grasp_pose}" trajectory="{trajectory_msg}"/>
      <Move action_name="{arm_action}" name="Move to grasp pose" trajectory="{trajectory_msg}"/>
      <Grip action_name="{gripper_action}" name="Close Gripper" pose="0.00"/>


      <!-- Get back to Retract Pose  -->
      <!-- <SubTree ID="Retract"/> -->
    </Sequence>
  </BehaviorTree>


  <BehaviorTree ID="Retract">
    <Sequence>
      <Plan target_ik="0.35;0.35;0.6;1;0;0;0" trajectory="{trajectory_msg}"/>
      <Move trajectory="{trajectory_msg}"/>
    </Sequence>
  </BehaviorTree>

</root>
